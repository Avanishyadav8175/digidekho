<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Contact Form - Digital Dekho</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .form-section { background: #f8f9fa; padding: 20px; margin: 15px 0; border-radius: 8px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
        button:hover { background: #0056b3; }
        .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üß™ Debug Contact Form Test</h1>
    <p>This form tests the complete workflow: Form ‚Üí API ‚Üí localStorage ‚Üí Admin Dashboard</p>

    <div class="form-section">
        <h3>Contact Form Test</h3>
        <form id="contactForm">
            <div class="form-group">
                <label for="name">Full Name *</label>
                <input type="text" id="name" name="name" required>
            </div>
            
            <div class="form-group">
                <label for="email">Email Address *</label>
                <input type="email" id="email" name="email" required>
            </div>
            
            <div class="form-group">
                <label for="phone">Phone Number *</label>
                <input type="tel" id="phone" name="phone" required>
            </div>
            
            <div class="form-group">
                <label for="company">Company Name</label>
                <input type="text" id="company" name="company">
            </div>
            
            <div class="form-group">
                <label for="service">Service Interested In</label>
                <select id="service" name="service">
                    <option value="">Select a service</option>
                    <option value="Web Development">Web Development</option>
                    <option value="App Development">App Development</option>
                    <option value="AI Automation">AI Automation</option>
                    <option value="Video Editing">Video Editing</option>
                    <option value="Photo Editing">Photo Editing</option>
                    <option value="Meta Ads">Meta Ads</option>
                    <option value="Google Ads">Google Ads</option>
                    <option value="SEO Services">SEO Services</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="budget">Project Budget</label>
                <select id="budget" name="budget">
                    <option value="">Select budget range</option>
                    <option value="Under $1,000">Under $1,000</option>
                    <option value="$1,000 - $5,000">$1,000 - $5,000</option>
                    <option value="$5,000 - $10,000">$5,000 - $10,000</option>
                    <option value="$10,000 - $25,000">$10,000 - $25,000</option>
                    <option value="$25,000 - $50,000">$25,000 - $50,000</option>
                    <option value="Over $50,000">Over $50,000</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="timeline">Project Timeline</label>
                <select id="timeline" name="timeline">
                    <option value="">Select timeline</option>
                    <option value="ASAP">ASAP</option>
                    <option value="Within 1 month">Within 1 month</option>
                    <option value="2-3 months">2-3 months</option>
                    <option value="3-6 months">3-6 months</option>
                    <option value="6+ months">6+ months</option>
                    <option value="Just exploring">Just exploring</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="message">Project Details *</label>
                <textarea id="message" name="message" rows="4" required placeholder="Tell us about your project requirements..."></textarea>
            </div>
            
            <button type="submit">Send Message</button>
            <button type="button" onclick="fillTestData()">Fill Test Data</button>
        </form>
        
        <div id="formResult"></div>
    </div>

    <div class="form-section">
        <h3>localStorage Status</h3>
        <button onclick="checkLocalStorage()">Check localStorage</button>
        <button onclick="clearLocalStorage()">Clear localStorage</button>
        <div id="localStorageStatus"></div>
    </div>

    <div class="form-section">
        <h3>Quick Actions</h3>
        <a href="/admin/leads" target="_blank">
            <button type="button">üîó Open Admin Leads</button>
        </a>
        <a href="/admin/notifications" target="_blank">
            <button type="button">üîó Open Admin Notifications</button>
        </a>
        <a href="/contact" target="_blank">
            <button type="button">üîó Open Main Contact Page</button>
        </a>
    </div>

    <script>
        // Fill form with test data
        function fillTestData() {
            document.getElementById('name').value = 'Debug Test User ' + Date.now();
            document.getElementById('email').value = 'debug' + Date.now() + '@test.com';
            document.getElementById('phone').value = '+1-555-' + Math.floor(Math.random() * 10000);
            document.getElementById('company').value = 'Debug Test Company';
            document.getElementById('service').value = 'Web Development';
            document.getElementById('budget').value = '$5,000 - $10,000';
            document.getElementById('timeline').value = '2-3 months';
            document.getElementById('message').value = 'This is a debug test message to verify the complete lead workflow from form submission to admin dashboard display.';
        }

        // Handle form submission
        document.getElementById('contactForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('formResult');
            resultDiv.innerHTML = '<div class="info">Submitting form...</div>';
            
            // Get form data
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            try {
                // Submit to API
                const response = await fetch('/api/leads', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                const result = await response.json();
                
                if (response.ok) {
                    // Save to localStorage (same as ContactSection component)
                    const existingLeads = JSON.parse(localStorage.getItem('admin-leads') || '[]');
                    const updatedLeads = [result.lead, ...existingLeads];
                    localStorage.setItem('admin-leads', JSON.stringify(updatedLeads));

                    // Add notification
                    const notification = {
                        id: Date.now() + Math.random(),
                        type: 'lead',
                        title: 'New Lead Received',
                        message: `${result.lead.name} submitted a ${result.lead.service} inquiry`,
                        timestamp: new Date().toISOString(),
                        read: false,
                        leadId: result.lead.id
                    };

                    const existingNotifications = JSON.parse(localStorage.getItem('admin-notifications') || '[]');
                    const updatedNotifications = [notification, ...existingNotifications];
                    localStorage.setItem('admin-notifications', JSON.stringify(updatedNotifications));

                    // Trigger storage events
                    window.dispatchEvent(new Event('storage'));
                    window.dispatchEvent(new Event('localStorageUpdate'));
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ Form submitted successfully!<br>
                            <strong>Lead ID:</strong> ${result.lead.id}<br>
                            <strong>Name:</strong> ${result.lead.name}<br>
                            <strong>Email:</strong> ${result.lead.email}<br>
                            <strong>Service:</strong> ${result.lead.service}<br>
                            <strong>Saved to localStorage:</strong> ${updatedLeads.length} total leads<br>
                            <strong>Notification created:</strong> ${updatedNotifications.length} total notifications<br><br>
                            <a href="/admin/leads" target="_blank">
                                <button type="button">üîó View in Admin Panel</button>
                            </a>
                        </div>
                    `;
                    
                    // Clear form
                    this.reset();
                    
                    // Auto-check localStorage
                    setTimeout(checkLocalStorage, 500);
                    
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Error: ${result.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Network Error: ${error.message}</div>`;
            }
        });

        // Check localStorage
        function checkLocalStorage() {
            const statusDiv = document.getElementById('localStorageStatus');
            
            try {
                const leads = localStorage.getItem('admin-leads');
                const notifications = localStorage.getItem('admin-notifications');
                
                let html = '<h4>localStorage Status:</h4>';
                
                if (leads) {
                    const parsedLeads = JSON.parse(leads);
                    html += `
                        <div class="success">
                            ‚úÖ <strong>admin-leads:</strong> ${parsedLeads.length} leads found<br>
                            Latest lead: ${parsedLeads[0]?.name || 'None'} (${parsedLeads[0]?.email || 'N/A'})
                        </div>
                    `;
                } else {
                    html += '<div class="error">‚ùå No admin-leads found in localStorage</div>';
                }
                
                if (notifications) {
                    const parsedNotifications = JSON.parse(notifications);
                    html += `
                        <div class="success">
                            ‚úÖ <strong>admin-notifications:</strong> ${parsedNotifications.length} notifications found<br>
                            Latest: ${parsedNotifications[0]?.title || 'None'}
                        </div>
                    `;
                } else {
                    html += '<div class="error">‚ùå No admin-notifications found in localStorage</div>';
                }
                
                statusDiv.innerHTML = html;
            } catch (error) {
                statusDiv.innerHTML = `<div class="error">‚ùå Error reading localStorage: ${error.message}</div>`;
            }
        }

        // Clear localStorage
        function clearLocalStorage() {
            localStorage.removeItem('admin-leads');
            localStorage.removeItem('admin-notifications');
            document.getElementById('localStorageStatus').innerHTML = '<div class="success">‚úÖ localStorage cleared</div>';
        }

        // Auto-check localStorage on page load
        window.addEventListener('load', checkLocalStorage);
    </script>
</body>
</html>